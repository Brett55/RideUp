function onMapClick(a){lat=a.latlng.lat,lng=a.latlng.lng;var b=lng+","+lat;"undefined"!=typeof newMarker?(map.removeLayer(newMarker),newMarker=L.marker([lat,lng]).addTo(map),bootbox.confirm("<h4>Create Ride Event?</h4>",function(a){return a===!0?(modalCreateRide(b),!1):void 0})):(newMarker=L.marker([lat,lng]).addTo(map),bootbox.confirm("<h4>Create Ride Event?</h4>",function(a){return a===!0?(modalCreateRide(b),!1):void 0}))}function loadGeoJSON(){$.ajax({dataType:"json",url:"data.geojson/",success:function(a){$(a.features).each(function(a,b){L.geoJson(b,{pointToLayer:function(a,b){return"CONFERENCE"===a.properties.rideType?L.marker(b,{icon:conference}):"GROUP_RIDE"===a.properties.rideType&&"TRAIL"===a.properties.roadOrDirt?L.marker(b,{icon:groupRideTrail}):"GROUP_RIDE"===a.properties.rideType&&"ROAD"===a.properties.roadOrDirt?L.marker(b,{icon:groupRideRoad}):"RACE"===a.properties.rideType&&"TRAIL"===a.properties.roadOrDirt?L.marker(b,{icon:trailRace}):"RACE"===a.properties.rideType&&"ROAD"===a.properties.roadOrDirt?L.marker(b,{icon:roadRace}):"BIKE_SWAP"===a.properties.rideType?L.marker(b,{icon:bikeSwap}):"TRAIL_WORK_DAY"===a.properties.rideType?L.marker(b,{icon:trailWorkDay}):"SPECIAL_EVENT"===a.properties.rideType?L.marker(b,{icon:specialEvent}):L.marker(b,{icon:default_icon})},onEachFeature:onEachFeature}).addTo(map)})}}).error(function(){})}function onEachFeature(a,b){b.on("click",onClick)}function onClick(a){marker=this;var b="",c="",d=marker.feature.properties.rideType,e=marker.feature.properties.roadOrDirt;"RACE"===d||"GROUP_RIDE"===d?(b=ajax_convert_names[d.toLowerCase()+"_"+e.toLowerCase()]+"/"+marker.feature.id+"/",c='<table id="detailTable" class="table table-striped table-bordered table-condensed"><tbody><tr><th><h4>'+convertNames[d.toLowerCase()+"_"+e.toLowerCase()]+"</h4></th></tr><tr><th>Name: </th><td>"+marker.feature.properties.name+"</td></tr><tr><th>Frequency: </th><td>"+marker.feature.properties.event_Frequency+"</td></tr>"):(b=ajax_convert_names[d.toLowerCase()]+"/"+marker.feature.id+"/",c='<table id="detailTable" class="table table-striped table-bordered table-condensed"><tbody><tr><th><h4>'+convertNames[d.toLowerCase()]+"</h4></th></tr><tr><th>Name: </th><td>"+marker.feature.properties.name+"</td></tr><tr><th>Frequency: </th><td>"+marker.feature.properties.event_Frequency+"</td></tr>"),$.ajax({dataType:"json",url:b,success:function(a){$(a).each(function(a,d){for(var e in d.fields){var a=convertNames[e],f=d.fields[e];if(a&&f){if("ridetime"===e){var g=new Date(d.fields[e]);f=g.toLocaleString(navigator.language,{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"2-digit"})}if("non_member_riders"===e){var h=f,i='<a id="getRiderInfoLinkNonMember" href="javascript:void(0)">'+f.length+" - Show Riders</a>";c+="<tr><th>"+a+"</th><td>"+i+"</td></tr>"}else if("riders"===e){var j=f,i='<a id="getRiderInfoLinkMember" href="javascript:void(0)">'+f.length+" - Show Riders</a>";c+="<tr><th>"+a+"</th><td>"+i+"</td></tr>"}else c+="rideLevelTrail"===e||"rideLevelRoad"===e||"rideTypeMTB"===e?"<tr><th>"+a+'</th><td id="'+e+'">'+f+"</td></tr>":"<tr><th>"+a+'</th><td id="'+e+'"class="editable">'+f+"</td></tr>"}}c+='</tbody></table><p><button id="joinRideButton" class="btn btn-primary">Join Ride</button><button id="editRideButton" class="btn btn-warning">Edit Ride</button></p>',bootbox.dialog({title:"Details",message:c,animate:!0}),$("#getRiderInfoLinkMember").click({param1:"member",param2:j},getRiders),$("#getRiderInfoLinkNonMember").click({param1:"non_member",param2:h},getRiders),$("#joinRideButton").click(createJoinRideForm),$("#editRideButton").click({param1:b},editJoinRideForm.change)})}})}function createJoinRideForm(){$(".bootbox-body").empty().append('<div class="row"><div class="col-xs-10 col-xs-offset-1 text-left"><form id="joinRideForm" class="form-horizontal" method="POST" role="form"><div class="form-group"><label>Name</label><br><input type="text" class="form-control" id="id_first_name" size="50"></div><div class="form-group" style="display: none" id="usernameGroup"><label>Username</label><br><input type="text" class="form-control" id="id_username" size="100"></div><div class="form-group" style="display: none" id="passwordGroup"><label>Password</label><br><input type="password" class="form-control" id="id_password" size="100"></div><div class="form-group"><button type="button" id="submitJoinRideForm" class="btn btn-primary">Submit</button><button type="button" id="memberJoinButton" class="btn btn-success">Become Member</button></div></form></div></div>'),$(".modal-title").html("Join Ride"),$("#memberJoinButton").click(function(){$("#usernameGroup").show(),$("#passwordGroup").show()}),$("#submitJoinRideForm").click(joinRide)}function joinRide(){var a="",b=marker.feature.properties.rideType,c=marker.feature.properties.roadOrDirt;return a="RACE"===b||"GROUP_RIDE"===b?"add_rider/"+ajax_convert_names[b.toLowerCase()+"_"+c.toLowerCase()]+"/"+marker.feature.id+"/":"/add_rider/"+ajax_convert_names[b.toLowerCase()]+"/"+marker.feature.id+"/",$.ajax({type:"POST",url:a,data:{first_name:$("#id_first_name").val(),username:$("#id_username").val(),password:$("#id_password").val()},success:function(){$(".bootbox-body").empty().append("<p>Success!</p>")},error:function(a,b,c){console.log("ERROR!"),$("#results").html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+b+" <a href='#' class='close'>&times;</a></div>"),console.log(a.status+": "+a.responseText)}}),!1}function getRiders(a){var b=a.data.param1,c=a.data.param2;return $(".riderInfoTable").remove(),$("#detailTable").after('<table class="riderInfoTable table table-striped table-bordered table-condensed"><tbody id="riderInfofromAjax"><tr><th>Riders</th></tr></tbody></table>'),0===c.length?($("<tr><td>No Riders Yet...</td></tr>").appendTo("#riderInfofromAjax"),0):void $.ajax({dataType:"json",url:"riders/"+b+"/",type:"GET",data:{riders:c},success:function(a){$(a).each(function(a,c){"member"===b?$("<tr><td>"+c.fields.first_name+"</td></tr>").appendTo("#riderInfofromAjax"):$("<tr><td>"+c.fields.name+"</td></tr>").appendTo("#riderInfofromAjax")})},error:function(a,b,c){console.log("ERROR!"),$("#results").html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+b+" <a href='#' class='close'>&times;</a></div>"),console.log(a.status+": "+a.responseText)}})}function modalCreateRide(a){$(".modal-content").empty().append('<div class="modal-header"><button class="bootbox-close-button close" aria-hidden="true" data-dismiss="modal" type="button">Ã—</button><h4 class="modal-title">Create Ride</h4></div><div class="modal-body"><div class="row"><div class="col-xs-10 col-xs-offset-1 text-left successMsg"><form id="post-form" class="form-horizontal" method="POST" role="form"><input id="id_coordinates" type="hidden" name="coordinates" maxlength="200" value="'+a+'"><div class="form-group"><label class="control-label" for="id_name">Name of Ride</label><input id="id_name" class="form-control" type="text" title="" style="height:30px" required="required" placeholder="A Local Spot" name="name" maxlength="100"></div><div class="form-group"><label class="control-label" for="id_rideType">Type of Event</label><select id="id_rideType" class="form-control" title="" required="required" name="rideType"><option selected="selected" value="BLANK">Select Type</option><option value="RACE">Race</option><option value="GROUP_RIDE">Group Ride</option><option value="SPECIAL_EVENT">Special Event</option><option value="TRAIL_WORK_DAY">Trail Work</option><option value="CONFERENCE">Conference</option><option value="BIKE_SWAP">Bike Swap</option></select></div><div id="fill"></div><div id="fill_last"></div></form></div></div></div>'),makeCreateRideFormLive()}function detailedUpdateForm(){var a=$("#id_roadOrDirt").val(),b=$("#id_rideType").val();$("#fill_last").empty(),$.ajax({dataType:"html",url:"form/"+b.toLowerCase()+"_"+a.toLowerCase(),success:function(c){$(c).each(function(c,d){$(d).appendTo("#fill_last").hide().fadeIn(1),jQuery("#id_ridetime").datetimepicker({format:"m-d-Y g:i A",pick12HourFormat:!0}),whichForm=b.toLowerCase()+"_"+a.toLowerCase()})}})}function makeCreateRideFormLive(){$("#id_rideType").change(function(){var a=$("#id_rideType").val();"blank"!=a.toLowerCase()?"RACE"===a||"GROUP_RIDE"===a?($("#fill").empty(),$("#fill_last").empty(),$('<div class="form-group"><label class="control-label" for="id_roadOrDirt">Trail or Road</label><select class="form-control" id="id_roadOrDirt" name="roadOrDirt" required="required" title=""><option value="SURFACE">Select Surface</option><option value="TRAIL">Trail</option><option value="ROAD">Road</option></select></div>').appendTo("#fill").hide().fadeIn(1),$("#id_roadOrDirt").change(detailedUpdateForm)):($("#fill").empty(),$("#fill_last").empty(),$("#fill").append('<div class="form-group"><label class="control-label" for="id_roadOrDirt">Trail or Road</label><select class="form-control" id="id_roadOrDirt" name="roadOrDirt" type="hidden" required="required" title=""><option value="TRAIL" selected>NA</option>'),$.ajax({dataType:"html",url:"form/"+a.toLowerCase(),success:function(b){$(b).each(function(b,c){$(c).appendTo("#fill").hide().fadeIn(1),jQuery("#id_ridetime").datetimepicker({format:"m-d-Y g:i A",pick12HourFormat:!0}),whichForm=a.toLowerCase()})}})):($("#fill").empty(),$("#fill_last").empty())});var a=$("#post-form");a.submit(function(){return $.ajax({type:"POST",url:ajax_convert_names[whichForm]+"/",data:a.serialize(),success:function(){$("#fill").empty(),$("#fill_last").empty(),$("#id_name").val(""),$("#id_rideType").val("BLANK"),loadGeoJSON(),map.removeLayer(newMarker),$(".successMsg").empty().append('<h3 class="logo">Success!</h3>')},error:function(a,b,c){console.log("ERROR!"),$("#results").html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+b+" <a href='#' class='close'>&times;</a></div>"),console.log(a.status+": "+a.responseText)}}),!1})}function popUps(a){"howTo"===a?bootbox.alert('<p class="navText">Simply click on the map and set a marker. You will then be prompted to add an event of your choosing. <br><br>Not sure where things are? Just click the search tool in the upper right corner of the map'):"members"===a?bootbox.alert('<p class="navText"> Becoming a member of Ride[up] is easy, and free. The benefits of membership include: <br><ul class="navText"><li>Ability to Sell Parts at Events</li><li>Create New Events with 1 click</li><li>Communicating with other Ride[up] Members</li><li>Profile Pictures</li>'):"about"===a&&bootbox.alert('<p class="navText text center"> The concept behind Ride[up] is simple:<br><br> 1) Find local bicycle related events<br><br> 2) Coordinate group rides with ease</p>')}var map=L.map("map").setView([39.0407056,-76.8590506],9),osmGeocoder=new L.Control.OSMGeocoder;map.addControl(osmGeocoder),L.tileLayer("http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map);var trailWorkDay=L.AwesomeMarkers.icon({prefix:"fa",icon:"bicycle",markerColor:"darkred"}),trailRace=L.AwesomeMarkers.icon({prefix:"fa",icon:"bicycle",markerColor:"green"}),roadRace=L.AwesomeMarkers.icon({prefix:"fa",icon:"bicycle",markerColor:"red"}),specialEvent=L.AwesomeMarkers.icon({prefix:"fa",icon:"bicycle",markerColor:"orange"}),bikeSwap=L.AwesomeMarkers.icon({prefix:"fa",icon:"bicycle",markerColor:"darkgreen"}),groupRideRoad=L.AwesomeMarkers.icon({prefix:"fa",icon:"bicycle",markerColor:"purple"}),groupRideTrail=L.AwesomeMarkers.icon({prefix:"fa",icon:"bicycle",markerColor:"blue"}),conference=L.AwesomeMarkers.icon({prefix:"fa",icon:"bicycle",markerColor:"darkpurple"}),default_icon=L.AwesomeMarkers.icon({icon:"home",markerColor:"cadetblue"});$(document).on("click",".modal-backdrop",function(a){var b=a.target.className;b&&!$("."+b).parents(".modal-dialog").length&&bootbox.hideAll(),editJoinRideForm.reset()}),map.on("click",onMapClick),$(document).ready(function(){loadGeoJSON(),bootbox.alert('<p class="navText text-center">Welcome to <b> Ride[up] !</b><br><br> Left Click the Map Below to Create a Group Ride<br><br>or <br><br> Simply Click Existing Events to View Details</p>')});var convertNames={description:"Details",locationAddress:"Address",Ridetime:"Time",postRideBeer:"Post-Ride Food & Beer Spot",cost:"Cost",ridetime:"Ride Time",website:"Website",hostedBy:"Hosted By",rideTypeMTB:"MTB Discipline",rideLevelTrail:"Skill Level",rideLevelRoad:"Road Pace",roadOrDirt:"Road Or Trail",rideType:"Event Type",name:"Name",coordinates:"Coordinates",riders:"Member Riders",non_member_riders:"Non Member Riders",race_trail:"Mountain Bike Race",group_ride_road:"Group Ride - Road",group_ride_trail:"Group Ride - MTB",race_road:"Road Race",special_event:"Special Event",trail_work_day:"Trail Work Day",bike_swap:"Swap Meet",conference:"Conference",DBL_BLACK:"Double Black Diamond",BLACK:"Single Black Diamond",BLUE:"Blue",GREEN:"Green"},ajax_convert_names={race_trail:"TrailRace",group_ride_road:"GroupRideRoad",group_ride_trail:"GroupRideDirt",race_road:"RoadRace",special_event:"RideSpecialEvent",trail_work_day:"TrailWorkDay",bike_swap:"BikeSwap",conference:"Conference"},cachedGetRiders={},whichForm="",editJoinRideForm=function(){var a=[],b={},c="";return{change:function(a){c=a.data.param1;var b=$("#editRideButton");$("<a class='edit-tag' href='#'><span class='glyphicon glyphicon-edit'>&nbsp</span></a").prependTo(".editable"),b.removeClass("btn-warning"),b.toggleClass("btn-success"),b.toggleClass("editSubmit"),b.text("Save Edits"),$(".edit-tag").click(editJoinRideForm.edit),$(".editSubmit").click(editJoinRideForm.submit)},submit:function(){editJoinRideForm.save(c)},reset:function(){var a=$("#editRideButton");a.removeClass("btn-success"),a.removeClass("editSubmit"),a.toggleClass("btn-warning"),a.text("Edit Ride")},edit:function(){var b=$(this).parent().attr("id"),c=$("#"+b).text();"ridetime"===b?($(this).parent().replaceWith('<input class="form-control" id="'+b+'"type="text" + placeholder="'+c+'"/>'),jQuery("#ridetime").datetimepicker({format:"m-d-Y g:i A",pick12HourFormat:!0})):$(this).parent().replaceWith('<input class="form-control" id="'+b+'"type="text" placeholder="'+c+'"/>'),a.push(b)},save:function(c){for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];b[e]=$("#"+e).val()}$.ajax({type:"PUT",url:"/update_event/"+c,data:b,success:function(){$(".bootbox-body").empty().append("<p>Success!</p>")},error:function(a,b){console.log("ERROR!"),$("#results").html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+b+" <a href='#' class='close'>&times;</a></div>"),console.log(a.status+": "+a.responseText)}})}}}();$("#howTo").click(function(){return popUps(this.id),!1}),$("#members").click(function(){return popUps(this.id),!1}),$("#about").click(function(){return popUps(this.id),!1});